#include "nm_hindmarsh_rose_1986.h"
#include "../../integration_methods.h"
#include "../neuron_models_aux_functions.h"

/**
 * @file nm_hindmarsh_rose_1986.h
 * @brief Source file for the Hindmarsh_Rose_1986 model functions.
 */

/** @name Hindmarsh_Rose_1986
 * Hindmarsh_Rose_1986 neuron model.
 */
///@{

double nm_hindmarsh_rose_1986_v (double * vars, double * params);
double nm_hindmarsh_rose_1986_y (double * vars, double * params);
double nm_hindmarsh_rose_1986_z (double * vars, double * params);
double nm_hindmarsh_rose_1986_set_pts_burst (double pts_live, neuron_model * nm);


double nm_hindmarsh_rose_1986_v (double * vars, double * params) {
	return vars[NM_HINDMARSH_ROSE_1986_Y] + params[NM_HINDMARSH_ROSE_1986_B] * (vars[NM_HINDMARSH_ROSE_1986_V]*vars[NM_HINDMARSH_ROSE_1986_V]) - params[NM_HINDMARSH_ROSE_1986_A] * (vars[NM_HINDMARSH_ROSE_1986_V]*vars[NM_HINDMARSH_ROSE_1986_V]*vars[NM_HINDMARSH_ROSE_1986_V]) - vars[NM_HINDMARSH_ROSE_1986_Z] + params[NM_HINDMARSH_ROSE_1986_I] - params[NM_HINDMARSH_ROSE_1986_SYN];
}

double nm_hindmarsh_rose_1986_y (double * vars, double * params) {
	return params[NM_HINDMARSH_ROSE_1986_C] - params[NM_HINDMARSH_ROSE_1986_D] * vars[NM_HINDMARSH_ROSE_1986_V]*vars[NM_HINDMARSH_ROSE_1986_V] - vars[NM_HINDMARSH_ROSE_1986_Y];
}

double nm_hindmarsh_rose_1986_z (double * vars, double * params) {
	return params[NM_HINDMARSH_ROSE_1986_R] * (params[NM_HINDMARSH_ROSE_1986_S] * (vars[NM_HINDMARSH_ROSE_1986_V] - params[NM_HINDMARSH_ROSE_1986_XR]) - vars[NM_HINDMARSH_ROSE_1986_Z]);
}

/**
 * @brief Hindmarsh_Rose_1986 neuron model differential equations.
 * @param[in] vars Neuron model variables
 * @param[out] ret Return values array
 * @param[in] params Neuron models parameters
 * @param[in] syn Synapse input current value
 */

void nm_hindmarsh_rose_1986_f (double * vars, double * ret, double * params, double syn) {
	params[NM_HINDMARSH_ROSE_1986_SYN] = syn;

	ret[NM_HINDMARSH_ROSE_1986_V] = nm_hindmarsh_rose_1986_v(vars, params);
	ret[NM_HINDMARSH_ROSE_1986_Y] = nm_hindmarsh_rose_1986_y(vars, params);
	ret[NM_HINDMARSH_ROSE_1986_Z] = nm_hindmarsh_rose_1986_z(vars, params);
}

/**
 * @brief Hindmarsh_Rose_1986 neuron model.
 * @param[in] nm Neuron model structure
 * @param[in] syn Synapse input current value
 */

void nm_hindmarsh_rose_1986 (neuron_model nm, double syn) {
	nm.method(nm_hindmarsh_rose_1986_f, nm.dim, nm.params[NM_HINDMARSH_ROSE_1986_DT], nm.vars, nm.params, syn);
	return;
}

/**
 * @brief Initializes Hindmarsh_Rose_1986 neuron model.
 * @param[in] nm Pointer to the neuron model structure
 * @param[in] vars Array with the initial values of the model variables
 * @param[in] params Array with the values of the mode parameters
 */

void nm_hindmarsh_rose_1986_init (neuron_model * nm, double * vars, double * params) {
	nm->dim = 3;
	nm->vars = (double *) malloc (sizeof(double) * nm->dim);
	copy_1d_array(vars, nm->vars, nm->dim);

	nm->n_params = 10;
	nm->params = (double *) malloc (sizeof(double) * nm->n_params);
	copy_1d_array(params, nm->params, nm->n_params);

	nm->max = 1.797032;
	nm->min = -1.608734;
	nm->pts_burst = -1.0;

	nm->func = &nm_hindmarsh_rose_1986;
	nm->set_pts_burst = &nm_hindmarsh_rose_1986_set_pts_burst;
	nm->method = integration_method_selector(params[NM_HINDMARSH_ROSE_1986_DT]);

	return;
}

/**
 * @brief Sets Hindmarsh_Rose_1986 model number of points per burst and integration step.
 * 
 * If not previously specified by the user, the number of points per burst of the model and its integration step is set according to the living neuron number of points per burst.
 * @param[in] pts_live Number of points in a living neuron burst
 * @param[in] nm Pointer to the neuron model structure
 */

double nm_hindmarsh_rose_1986_set_pts_burst (double pts_live, neuron_model * nm) {
	int length = 0;
	int method = nm->params[NM_HINDMARSH_ROSE_1986_DT];

	switch(method) {
		case EULER:
		{
			length = 150.000000 - 79;
			double dts[] = {0.000500, 0.000600, 0.000700, 0.000800, 0.000900, 0.001000, 0.001100, 0.001200, 0.001300, 0.001400, 0.001500, 0.001600, 0.001800, 0.002000, 0.002200, 0.002500, 0.002800, 0.002900, 0.003000, 0.003100, 0.003200, 0.003300, 0.003400, 0.003500, 0.003600, 0.003700, 0.003800, 0.003900, 0.004000, 0.004100, 0.004200, 0.004300, 0.004400, 0.004500, 0.004600, 0.004700, 0.004800, 0.004900, 0.005000, 0.005100, 0.005200, 0.005300, 0.005500, 0.005700, 0.005900, 0.006100, 0.006300, 0.006500, 0.006700, 0.006900, 0.007100, 0.007300, 0.007600, 0.007900, 0.008200, 0.008500, 0.008800, 0.009100, 0.009500, 0.009900, 0.010300, 0.010800, 0.011400, 0.014500, 0.014900, 0.015000, 0.015900, 0.016600, 0.017700, 0.019100, 0.020700/*, 0.026400, 0.026700, 0.027000, 0.027100, 0.027200, 0.027300, 0.027400, 0.027500, 0.027600, 0.027700, 0.027800, 0.027900, 0.028000, 0.028100, 0.035000, 0.037400, 0.040100, 0.043300, 0.046700, 0.047100, 0.047500, 0.047900, 0.048300, 0.048700, 0.049200, 0.049700, 0.050200, 0.050700, 0.051200, 0.051700, 0.052200, 0.052700, 0.053200, 0.053700, 0.054200, 0.054800, 0.055400, 0.056000, 0.056600, 0.057200, 0.057800, 0.058400, 0.059000, 0.059700, 0.060400, 0.061100, 0.061800, 0.062500, 0.063200, 0.064000, 0.064800, 0.065600, 0.066400, 0.067200, 0.068100, 0.069000, 0.069900, 0.070800, 0.071800, 0.072800, 0.073800, 0.074900, 0.076000, 0.077100, 0.078300, 0.079500, 0.080700, 0.082000, 0.083300, 0.084700, 0.086100, 0.087600, 0.089200, 0.090800, 0.092500, 0.094300, 0.096100, 0.098000, 0.100000*/};
			double pts[] = {574614.000000, 478462.000000, 409810.000000, 356685.500000, 317007.000000, 285272.000000, 258809.666667, 237252.000000, 218845.000000, 203240.500000, 189720.000000, 177822.000000, 158131.800000, 142360.166667, 129476.142857, 114040.000000, 101925.666667, 98447.777778, 95202.555556, 92166.800000, 89322.500000, 86651.454545, 84138.454545, 81769.727273, 79533.916667, 77419.166667, 75416.250000, 73517.769231, 71713.846154, 69998.461538, 68366.642857, 66810.071429, 65324.785714, 63907.333333, 62550.866667, 61252.600000, 60010.250000, 58817.875000, 57673.625000, 56576.000000, 55519.882353, 54504.058824, 52585.777778, 50803.947368, 49143.578947, 47594.900000, 46146.285714, 44787.571429, 43512.681818, 42313.434783, 41182.565217, 40116.375000, 38625.200000, 37251.423077, 35982.555556, 34807.892857, 33718.275862, 32705.866667, 31464.548387, 30335.875000, 29310.060606, 28163.771429, 26989.500000, 25894.789474, 20884.425532, 19338.470588, 18226.259259, 17094.736842, 16082.754098, 15003.833333/*, 13993.814286, 12941.855263, 10479.989362, 9294.373832, 6487.810458, 5938.451807, 4757.033493, 4016.534413, 3374.965870, 3035.217125, 2647.277333, 2362.669834, 2183.784615, 1958.540594, 1735.901754, 1412.043972, 1311.606061, 1208.506068, 1106.745556, 1005.905146, 994.941118, 984.176703, 973.608398, 963.229952, 953.039197, 940.552830, 928.340782, 916.395221, 904.706897, 893.267025, 882.069912, 871.107517, 860.376186, 849.862745, 839.564448, 829.476705, 817.636587, 806.080032, 794.794258, 783.774371, 773.009302, 762.490826, 752.210407, 742.160714, 730.719414, 719.571429, 708.706468, 698.115465, 687.786897, 677.713315, 666.500334, 655.595003, 644.987072, 634.663486, 624.614277, 613.624846, 602.955891, 592.593824, 582.527145, 571.673926, 561.155793, 550.957482, 540.093074, 529.582803, 519.411244, 508.681957, 498.319021, 488.304305, 477.829584, 467.725398, 457.237288, 447.137097, 436.723097, 426.054204, 415.814244, 405.377182, 394.795176, 384.667437, 374.439610, 364.156455*/};

			select_dt_neuron_model(dts, pts, length, pts_live, &(nm->params[NM_HINDMARSH_ROSE_1986_DT]), &(nm->pts_burst));
			break;
		}
		case HEUN:
		{
			length = 143.000000;
			double dts[] = {0.000500, 0.000600, 0.000700, 0.000800, 0.000900, 0.001000, 0.001100, 0.001200, 0.001300, 0.001400, 0.001500, 0.001600, 0.001800, 0.002000, 0.002200, 0.002500, 0.002800, 0.002900, 0.003000, 0.003100, 0.003200, 0.003300, 0.003400, 0.003500, 0.003600, 0.003700, 0.003800, 0.003900, 0.004000, 0.004100, 0.004200, 0.004300, 0.004400, 0.004500, 0.004600, 0.004700, 0.004800, 0.004900, 0.005000, 0.005100, 0.005200, 0.005400, 0.005600, 0.005800, 0.006000, 0.006200, 0.006400, 0.006600, 0.006800, 0.007000, 0.007200, 0.007400, 0.007700, 0.008000, 0.008300, 0.008600, 0.008900, 0.009200, 0.009600, 0.010000, 0.010400, 0.010900, 0.011400, 0.011900, 0.012500, 0.013100, 0.013800, 0.014600, 0.015400, 0.016300, 0.017400, 0.018600, 0.020000, 0.021600, 0.023500, 0.025700, 0.028300, 0.028600, 0.028900, 0.029300, 0.029700, 0.030100, 0.030500, 0.030900, 0.031300, 0.031700, 0.032100, 0.032500, 0.032900, 0.033300, 0.033700, 0.034200, 0.034700, 0.035200, 0.035700, 0.036200, 0.036700, 0.037200, 0.037700, 0.038300, 0.038900, 0.039500, 0.040100, 0.040700, 0.041300, 0.042000, 0.042700, 0.043400, 0.044100, 0.044900, 0.045700, 0.046500, 0.047300, 0.048200, 0.049100, 0.050000, 0.051000, 0.052000, 0.053000, 0.054100, 0.055200, 0.056400, 0.057600, 0.058900, 0.060200, 0.061600, 0.063000, 0.064500, 0.066100, 0.067700, 0.069400, 0.071200, 0.073100, 0.075100, 0.077200, 0.079500, 0.081900, 0.084400, 0.087100, 0.090000, 0.093100, 0.096400, 0.100000};
			double pts[] = {577638.000000, 481365.000000, 412598.000000, 357615.000000, 317879.500000, 286092.000000, 259143.000000, 237547.666667, 218869.500000, 203235.750000, 189686.750000, 177634.000000, 157896.800000, 142001.833333, 129024.142857, 113496.125000, 101304.555556, 97811.222222, 94527.500000, 91478.300000, 88619.600000, 85916.727273, 83389.818182, 81007.272727, 78743.833333, 76615.583333, 74599.416667, 72676.307692, 70859.384615, 69131.153846, 67476.857143, 65907.642857, 64402.933333, 62971.800000, 61602.866667, 60286.625000, 59030.687500, 57826.000000, 56664.823529, 55553.764706, 54485.411765, 52463.722222, 50586.736842, 48842.421053, 47211.600000, 45686.285714, 44256.500000, 42915.454545, 41651.434783, 40459.833333, 39336.000000, 38271.480000, 36779.230769, 35398.962963, 34118.571429, 32927.586207, 31816.900000, 30778.774194, 29495.151515, 28314.882353, 27225.000000, 25975.837838, 24835.923077, 23791.902439, 22649.511628, 21611.822222, 20515.166667, 19390.784314, 18383.415094, 17368.175439, 16270.266667, 15220.569231, 14155.285714, 13107.066667, 12047.768293, 11017.066667, 10005.757576, 9900.910000, 9798.247525, 9664.647059, 9534.625000, 9408.085714, 9284.859813, 9164.833333, 9047.889908, 8933.873874, 8822.723214, 8714.298246, 8608.530435, 8505.299145, 8404.533898, 8281.883333, 8162.785124, 8047.073171, 7934.600000, 7825.251969, 7718.883721, 7615.384615, 7514.643939, 7397.231343, 7283.448529, 7173.130435, 7066.121429, 6962.279720, 6861.462069, 6747.503401, 6637.293333, 6530.644737, 6427.393548, 6313.363057, 6203.331250, 6097.110429, 5994.493976, 5883.147929, 5775.906977, 5672.542857, 5562.005587, 5455.747253, 5353.526882, 5245.478947, 5141.777202, 5033.303030, 4929.386139, 4821.635922, 4718.597156, 4612.546296, 4511.271493, 4407.707965, 4302.497835, 4202.345992, 4101.082305, 3999.236948, 3897.292969, 3795.687023, 3694.814815, 3590.631769, 3488.360140, 3388.234694, 3286.825083, 3184.996805, 3083.532508, 2983.134731, 2881.705202};

			select_dt_neuron_model(dts, pts, length, pts_live, &(nm->params[NM_HINDMARSH_ROSE_1986_DT]), &(nm->pts_burst));
			break;
		}
		case RK4:
		{
			length = 144.000000;
			double dts[] = {0.000500, 0.000600, 0.000700, 0.000800, 0.000900, 0.001000, 0.001100, 0.001200, 0.001300, 0.001400, 0.001500, 0.001600, 0.001800, 0.002000, 0.002200, 0.002500, 0.002800, 0.002900, 0.003000, 0.003100, 0.003200, 0.003300, 0.003400, 0.003500, 0.003600, 0.003700, 0.003800, 0.003900, 0.004000, 0.004100, 0.004200, 0.004300, 0.004400, 0.004500, 0.004600, 0.004700, 0.004800, 0.004900, 0.005000, 0.005100, 0.005200, 0.005400, 0.005600, 0.005800, 0.006000, 0.006200, 0.006400, 0.006600, 0.006800, 0.007000, 0.007200, 0.007400, 0.007700, 0.008000, 0.008300, 0.008600, 0.008900, 0.009200, 0.009600, 0.010000, 0.010400, 0.010900, 0.011400, 0.011900, 0.012500, 0.013100, 0.013800, 0.014600, 0.015400, 0.016300, 0.017300, 0.018500, 0.019900, 0.021500, 0.023300, 0.025500, 0.028100, 0.028400, 0.028700, 0.029000, 0.029400, 0.029800, 0.030200, 0.030600, 0.031000, 0.031400, 0.031800, 0.032200, 0.032600, 0.033000, 0.033400, 0.033900, 0.034400, 0.034900, 0.035400, 0.035900, 0.036400, 0.036900, 0.037400, 0.038000, 0.038600, 0.039200, 0.039800, 0.040400, 0.041000, 0.041700, 0.042400, 0.043100, 0.043800, 0.044500, 0.045300, 0.046100, 0.046900, 0.047700, 0.048600, 0.049500, 0.050400, 0.051400, 0.052400, 0.053400, 0.054500, 0.055600, 0.056800, 0.058000, 0.059300, 0.060600, 0.062000, 0.063400, 0.064900, 0.066500, 0.068200, 0.069900, 0.071700, 0.073600, 0.075600, 0.077700, 0.079900, 0.082300, 0.084800, 0.087500, 0.090300, 0.093300, 0.096500, 0.100000};
			double pts[] = {577638.000000, 481366.000000, 412599.000000, 357615.500000, 317880.000000, 286092.500000, 259143.333333, 237548.000000, 218869.500000, 203236.000000, 189687.000000, 177634.000000, 157897.000000, 142001.833333, 129024.142857, 113496.125000, 101304.555556, 97811.222222, 94527.400000, 91478.200000, 88619.400000, 85916.636364, 83389.636364, 81007.090909, 78743.583333, 76615.416667, 74599.250000, 72676.000000, 70859.076923, 69130.846154, 67476.642857, 65907.357143, 64402.666667, 62971.466667, 61602.533333, 60286.187500, 59030.250000, 57825.562500, 56664.411765, 55553.294118, 54485.000000, 52463.222222, 50586.263158, 48841.842105, 47211.050000, 45685.666667, 44255.818182, 42914.772727, 41650.739130, 40459.083333, 39335.208333, 38270.680000, 36778.346154, 35398.000000, 34117.571429, 32926.517241, 31815.833333, 30777.612903, 29493.939394, 28313.588235, 27223.638889, 25974.405405, 24834.410256, 23790.268293, 22647.767442, 21609.977778, 20513.166667, 19388.627451, 18381.132075, 17365.719298, 16361.600000, 15299.937500, 14223.202899, 13164.400000, 12147.123457, 11098.865169, 10071.693878, 9965.282828, 9861.090000, 9759.049505, 9626.233010, 9497.000000, 9371.179245, 9248.663551, 9129.284404, 9012.981818, 8899.585586, 8789.000000, 8681.149123, 8575.887931, 8473.170940, 8348.168067, 8226.801653, 8108.926230, 7994.370968, 7883.007937, 7774.703125, 7669.341085, 7566.793893, 7447.293233, 7331.518519, 7219.284672, 7110.421429, 7004.809859, 6902.284722, 6786.404110, 6674.342282, 6565.927152, 6460.974026, 6359.320513, 6247.000000, 6138.574074, 6033.848485, 5932.636905, 5822.754386, 5716.873563, 5614.774011, 5505.513812, 5400.440217, 5299.292553, 5192.317708, 5089.579487, 4982.035000, 4878.946078, 4771.966507, 4669.586854, 4564.128440, 4463.327354, 4360.153509, 4255.230769, 4149.145833, 4048.219512, 3946.571429, 3844.671815, 3742.939850, 3641.762774, 3541.462633, 3438.165517, 3336.779264, 3233.785714, 3133.484277, 3032.696049, 2932.091176, 2829.426136};

			select_dt_neuron_model(dts, pts, length, pts_live, &(nm->params[NM_HINDMARSH_ROSE_1986_DT]), &(nm->pts_burst));
			break;
		}
		case RK65:
		{
			length = 144.000000;
			double dts[] = {0.000500, 0.000600, 0.000700, 0.000800, 0.000900, 0.001000, 0.001100, 0.001200, 0.001300, 0.001400, 0.001500, 0.001600, 0.001800, 0.002000, 0.002200, 0.002500, 0.002800, 0.002900, 0.003000, 0.003100, 0.003200, 0.003300, 0.003400, 0.003500, 0.003600, 0.003700, 0.003800, 0.003900, 0.004000, 0.004100, 0.004200, 0.004300, 0.004400, 0.004500, 0.004600, 0.004700, 0.004800, 0.004900, 0.005000, 0.005100, 0.005200, 0.005400, 0.005600, 0.005800, 0.006000, 0.006200, 0.006400, 0.006600, 0.006800, 0.007000, 0.007200, 0.007400, 0.007700, 0.008000, 0.008300, 0.008600, 0.008900, 0.009200, 0.009600, 0.010000, 0.010400, 0.010900, 0.011400, 0.011900, 0.012500, 0.013100, 0.013800, 0.014600, 0.015400, 0.016300, 0.017300, 0.018500, 0.019900, 0.021500, 0.023300, 0.025500, 0.028100, 0.028400, 0.028700, 0.029000, 0.029400, 0.029800, 0.030200, 0.030600, 0.031000, 0.031400, 0.031800, 0.032200, 0.032600, 0.033000, 0.033400, 0.033900, 0.034400, 0.034900, 0.035400, 0.035900, 0.036400, 0.036900, 0.037400, 0.038000, 0.038600, 0.039200, 0.039800, 0.040400, 0.041000, 0.041700, 0.042400, 0.043100, 0.043800, 0.044500, 0.045300, 0.046100, 0.046900, 0.047700, 0.048600, 0.049500, 0.050400, 0.051400, 0.052400, 0.053400, 0.054500, 0.055600, 0.056800, 0.058000, 0.059300, 0.060600, 0.062000, 0.063400, 0.064900, 0.066500, 0.068200, 0.069900, 0.071700, 0.073600, 0.075600, 0.077700, 0.079900, 0.082300, 0.084800, 0.087500, 0.090300, 0.093300, 0.096500, 0.100000};
			double pts[] = {577638.000000, 481366.000000, 412599.000000, 357615.500000, 317880.000000, 286092.500000, 259143.333333, 237548.000000, 218869.500000, 203236.000000, 189687.000000, 177634.000000, 157897.000000, 142001.833333, 129024.142857, 113496.125000, 101304.555556, 97811.222222, 94527.400000, 91478.200000, 88619.400000, 85916.636364, 83389.636364, 81007.090909, 78743.583333, 76615.416667, 74599.250000, 72676.000000, 70859.076923, 69130.846154, 67476.642857, 65907.357143, 64402.666667, 62971.466667, 61602.533333, 60286.187500, 59030.250000, 57825.562500, 56664.411765, 55553.294118, 54485.000000, 52463.222222, 50586.263158, 48841.842105, 47211.050000, 45685.666667, 44255.818182, 42914.772727, 41650.739130, 40459.083333, 39335.208333, 38270.680000, 36778.346154, 35398.000000, 34117.571429, 32926.517241, 31815.833333, 30777.612903, 29493.939394, 28313.588235, 27223.638889, 25974.405405, 24834.410256, 23790.268293, 22647.767442, 21609.977778, 20513.166667, 19388.627451, 18381.132075, 17365.719298, 16361.600000, 15299.937500, 14223.202899, 13164.400000, 12147.123457, 11098.876404, 10071.693878, 9965.282828, 9861.100000, 9759.059406, 9626.242718, 9497.009615, 9371.179245, 9248.672897, 9129.293578, 9012.981818, 8899.594595, 8789.000000, 8681.149123, 8575.896552, 8473.170940, 8348.176471, 8226.809917, 8108.934426, 7994.379032, 7883.015873, 7774.710938, 7669.348837, 7566.801527, 7447.308271, 7331.525926, 7219.291971, 7110.435714, 7004.816901, 6902.298611, 6786.417808, 6674.355705, 6565.940397, 6460.987013, 6359.339744, 6247.012579, 6138.592593, 6033.866667, 5932.660714, 5822.777778, 5716.896552, 5614.796610, 5505.541436, 5400.467391, 5299.324468, 5192.348958, 5089.615385, 4982.075000, 4878.985294, 4772.014354, 4669.633803, 4564.178899, 4463.381166, 4360.214912, 4255.294872, 4149.216667, 4048.296748, 3946.654762, 3844.764479, 3743.041353, 3641.872263, 3541.583630, 3438.300000, 3336.926421, 3233.951299, 3133.666667, 3032.899696, 2932.320588, 2829.684659};

			select_dt_neuron_model(dts, pts, length, pts_live, &(nm->params[NM_HINDMARSH_ROSE_1986_DT]), &(nm->pts_burst));
			break;
		}
	}

	return nm->params[NM_HINDMARSH_ROSE_1986_DT];
}

///@}